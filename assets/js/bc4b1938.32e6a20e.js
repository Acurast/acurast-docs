"use strict";(globalThis.webpackChunkwebsite=globalThis.webpackChunkwebsite||[]).push([[5111],{5680:(e,t,n)=>{n.d(t,{xA:()=>p,yg:()=>g});var a=n(6540);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach(function(t){r(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function s(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var l=a.createContext({}),c=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},p=function(e){var t=c(e.components);return a.createElement(l.Provider,{value:t},e.children)},d="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},h=a.forwardRef(function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,l=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),d=c(n),h=r,g=d["".concat(l,".").concat(h)]||d[h]||u[h]||o;return n?a.createElement(g,i(i({ref:t},p),{},{components:n})):a.createElement(g,i({ref:t},p))});function g(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,i=new Array(o);i[0]=h;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[d]="string"==typeof e?e:r,i[1]=s;for(var c=2;c<o;c++)i[c]=n[c];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}h.displayName="MDXCreateElement"},9446:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>p,contentTitle:()=>l,default:()=>g,frontMatter:()=>s,metadata:()=>c,toc:()=>d});var a=n(8168),r=(n(6540),n(5680)),o=n(1653),i=n(6025);const s={title:"Node Setup",slug:"/acurast-protocol/node-setup"},l=void 0,c={unversionedId:"acurast-protocol/node-setup",id:"acurast-protocol/node-setup",title:"Node Setup",description:"The recommended way to run the Acurast node is by using the published Docker image.",source:"@site/docs/acurast-protocol/node-setup.mdx",sourceDirName:"acurast-protocol",slug:"/acurast-protocol/node-setup",permalink:"/acurast-protocol/node-setup",draft:!1,editUrl:"https://github.com/acurast/acurast-docs/docs/acurast-protocol/node-setup.mdx",tags:[],version:"current",frontMatter:{title:"Node Setup",slug:"/acurast-protocol/node-setup"},sidebar:"docs",previous:{title:"Instances",permalink:"/acurast-protocol/architecture/instances"},next:{title:"Ecosystems & Integrations",permalink:"/integrations"}},p={},d=[{value:"Get the chain spec",id:"get-the-chain-spec",level:2},{value:"Configure the node",id:"configure-the-node",level:2},{value:"Start the node",id:"start-the-node",level:2},{value:"Run a Collator",id:"run-a-collator",level:2},{value:"Collator Onboarding",id:"collator-onboarding",level:2},{value:"Pre registration checks",id:"pre-registration-checks",level:3},{value:"Set session key",id:"set-session-key",level:3},{value:"Register as candidate",id:"register-as-candidate",level:3}],u={toc:d},h="wrapper";function g({components:e,...t}){return(0,r.yg)(h,(0,a.A)({},u,t,{components:e,mdxType:"MDXLayout"}),(0,r.yg)("p",null,"The recommended way to run the Acurast node is by using the published ",(0,r.yg)("a",{parentName:"p",href:"https://hub.docker.com/r/acurast/node-canary/tags"},"Docker image"),"."),(0,r.yg)("h2",{id:"get-the-chain-spec"},"Get the chain spec"),(0,r.yg)("p",null,"Download the Acurast chain spec from the Acurast GitHub repository: "),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("a",{parentName:"li",href:"https://github.com/Acurast/acurast-substrate/blob/acurast-v0.21.0/chain-specs/acurast-kusama-parachain-2239-raw.json"},"Acurast Canary chain spec")),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("a",{parentName:"li",href:"https://github.com/Acurast/acurast-substrate/blob/acurast-v0.21.0/chain-specs/acurast-mainnet-parachain-3396-raw.json"},"Acurast Mainnet chain spec"))),(0,r.yg)("h2",{id:"configure-the-node"},"Configure the node"),(0,r.yg)("p",null,"Create an ",(0,r.yg)("inlineCode",{parentName:"p"},"acurast-node")," folder. Inside this folder, the following 2 folders and file:"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("inlineCode",{parentName:"li"},"chain-specs")," - place the downloaded chain spec here"),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("inlineCode",{parentName:"li"},"data")," - this is where the node will store its data"),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("inlineCode",{parentName:"li"},"docker-compose.yml")," - this is where the docker-compose configuration will be placed")),(0,r.yg)("p",null,"In the ",(0,r.yg)("inlineCode",{parentName:"p"},"docker-compose.yml")," file, put the following content:"),(0,r.yg)("p",null,"For Acurast Canary:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-yml"},'services:\n  node:\n    image: "acurast/node-canary:acurast-v0.20.0"\n    command: "--chain /node/chain-specs/acurast-kusama-parachain-2239-raw.json \\\n      --base-path /node/data \\\n      --bootnodes /ip4/57.129.99.69/tcp/30334/ws/p2p/12D3KooWKrSDeVQ4tVQ1eGjqVAhAW3cgMQFHNCBbJrpmupEvdD4A \\\n      --port 30334 \\\n      --rpc-port 9934 \\\n      --rpc-external \\\n      --rpc-methods safe \\\n      --rpc-cors all \\\n      --name MyNode \\ # choose an appropriate name here\n      --telemetry-url \\"wss://telemetry.polkadot.io/submit/ 0\\" \\\n      --database=rocksdb \\\n      --pruning=archive"\n    ports:\n      - "30334:30334"\n      - "9934:9934"\n    volumes:\n      - ./:/node\n    logging:\n      options:\n        max-size: "10m"\n        max-file: "3"\n')),(0,r.yg)("p",null,"For Acurast Mainnet:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-yml"},'services:\n  node:\n    image: "acurast/node-mainnet:acurast-v0.20.0"\n    command: "--chain /node/chain-specs/acurast-mainnet-parachain-3396-raw.json \\\n      --base-path /node/data \\\n      --bootnodes /ip4/82.220.38.222/tcp/30335/ws/p2p/12D3KooWMJM3htCon6tQ6FzRuWkxtwEkd3i5awZitdTviWwJX3KY \\\n      --port 30334 \\\n      --rpc-port 9934 \\\n      --rpc-external \\\n      --rpc-methods safe \\\n      --rpc-cors all \\\n      --name MyNode \\ # choose an appropriate name here\n      --telemetry-url \\"wss://telemetry.polkadot.io/submit/ 0\\" \\\n      --database=rocksdb \\\n      --pruning=archive"\n    ports:\n      - "30334:30334"\n      - "9934:9934"\n    volumes:\n      - ./:/node\n    logging:\n      options:\n        max-size: "10m"\n        max-file: "3"\n')),(0,r.yg)("p",null,"The configuration above will start the Acurast node with the following options:"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("inlineCode",{parentName:"li"},"--chain")," - specifies the chain spec file"),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("inlineCode",{parentName:"li"},"--base-path")," - specifies the base path for the node data"),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("inlineCode",{parentName:"li"},"--bootnodes")," - specifies the bootnodes to connect to"),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("inlineCode",{parentName:"li"},"--port")," - specifies the p2p port for the node"),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("inlineCode",{parentName:"li"},"--rpc-port")," - specifies the RPC port for the node"),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("inlineCode",{parentName:"li"},"--rpc-external")," - allows external access to the RPC interface"),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("inlineCode",{parentName:"li"},"--rpc-methods safe")," - allows only safe RPC methods"),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("inlineCode",{parentName:"li"},"--rpc-cors all")," - allows all CORS requests"),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("inlineCode",{parentName:"li"},"--name")," - the name of the node"),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("inlineCode",{parentName:"li"},"--telemetry-url")," - The telemetry URL, the node will send telemetry data to ",(0,r.yg)("a",{parentName:"li",href:"https://telemetry.polkadot.io/#/0xce7681fb12aa8f7265d229a9074be0ea1d5e99b53eedcec2deade43857901808"},"telemetry.polkadot.io")," under the configured ",(0,r.yg)("inlineCode",{parentName:"li"},"name")),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("inlineCode",{parentName:"li"},"--database=rocksdb")," - specifies the database type"),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("inlineCode",{parentName:"li"},"--pruning=archive")," - specifies the pruning mode, change ",(0,r.yg)("inlineCode",{parentName:"li"},"archive")," to the number of blocks to keep if you want to prune the database")),(0,r.yg)("h2",{id:"start-the-node"},"Start the node"),(0,r.yg)("p",null,"In ",(0,r.yg)("inlineCode",{parentName:"p"},"acurast-node")," folder and run the following command:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-bash"},"docker compose up -d\n")),(0,r.yg)("p",null,"This will start the Acurast node in detached mode. You can check the logs by running:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-bash"},"docker compose logs -f\n")),(0,r.yg)("h2",{id:"run-a-collator"},"Run a Collator"),(0,r.yg)("p",null,"A node can be turned into a collator configuring its identity. One way to do so is to use a tool like ",(0,r.yg)("a",{parentName:"p",href:"https://docs.rs/crate/subkey/latest"},"subkey"),"."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-bash"},"subkey generate\n")),(0,r.yg)("p",null,"The output of the above command is something like:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre"},"Secret phrase:       <MNEMONIC>\n  Network ID:        substrate\n  Secret seed:       0x4f....\n  Public key (hex):  0x86....\n  Account ID:        0x86....\n  Public key (SS58): 5F7Cm8Kt57dX3SkdtYYDGdMn3yiPvC8dr3oSratmGjjLmSss\n  SS58 Address:      5F7Cm8Kt57dX3SkdtYYDGdMn3yiPvC8dr3oSratmGjjLmSss\n")),(0,r.yg)("p",null,"Then configure the node with the generated key by calling the following RPC:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-bash"},'curl -H "Content-Type: application/json" \\\n--data \'{\n  "jsonrpc":"2.0",\n  "method":"author_insertKey",\n  "params":[\n    "aura",\n    "INSERT_SECRET_PHRASE",\n    "INSERT_PUBLIC_KEY_HEX_FORMAT"\n  ],\n  "id":1\n}\' \\\nhttp://localhost:9934\n')),(0,r.yg)("p",null,"In order for the above call to succeed, the node needs to be started with ",(0,r.yg)("inlineCode",{parentName:"p"},"--rpc-methods unsafe"),". Once the key has been registered, the node can be restarted with the ",(0,r.yg)("inlineCode",{parentName:"p"},"--collator")," flag."),(0,r.yg)("p",null,"The node is now setup as a collator, but it will not start authoring blocks yet. At this stage, the Acurast team manages the list of collators that can actually author blocks."),(0,r.yg)("h2",{id:"collator-onboarding"},"Collator Onboarding"),(0,r.yg)("h3",{id:"pre-registration-checks"},"Pre registration checks"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},"Make sure the node is setup with an identity as described above."),(0,r.yg)("li",{parentName:"ul"},"Make sure the node is fully synced."),(0,r.yg)("li",{parentName:"ul"},"Make sure the node was started with the ",(0,r.yg)("inlineCode",{parentName:"li"},"--collator")," flag."),(0,r.yg)("li",{parentName:"ul"},"Make sure the node is running on hardware that meet the minimum requirements. It is possible to check by looking at the node logs when it first starts:")),(0,r.yg)(o.A,{width:"1000px",sources:{light:(0,i.A)("/img/node-hardware-checks.png"),dark:(0,i.A)("/img/node-hardware-checks.png")},mdxType:"ThemedImage"}),(0,r.yg)("p",null,"  If  the hardware is good enough, there should not be any warning log message after the benchmarks logs shown in the screenshot above."),(0,r.yg)("h3",{id:"set-session-key"},"Set session key"),(0,r.yg)("p",null,"A session key needs to be registered. To do that, first perform the ",(0,r.yg)("inlineCode",{parentName:"p"},"author_rotateKeys")," RPC call in order to generate a new session key:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-bash"},'curl -H "Content-Type: application/json" \\\n--data \'{\n  "jsonrpc":"2.0",\n  "method":"author_rotateKeys",\n  "params":[],\n  "id":1\n}\' \\\nhttp://localhost:9934\n')),(0,r.yg)("p",null,"The output of the above command should be something like:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-json"},'{\n  "jsonrpc": "2.0",\n  "id": 1,\n  "result": "0xcc038816bd81c238bd1d163c48cea9c5e3b62899b8f193863f68268a719cca44"\n}\n')),(0,r.yg)("blockquote",null,(0,r.yg)("p",{parentName:"blockquote"},(0,r.yg)("strong",{parentName:"p"},(0,r.yg)("em",{parentName:"strong"},"WARNING:"))," If the node exposes the RPC port to the internet, directly or through a reverse proxy, please make sure to restart the node with the argument ",(0,r.yg)("inlineCode",{parentName:"p"},"--rpc-methods safe")," so that RPC methods related to the collator keys cannot be called anymore. For more information, see the ",(0,r.yg)("a",{parentName:"p",href:"https://paritytech.github.io/devops-guide/guides/rpc_index.html?#important-flags-for-running-an-rpc-node"},"RPC Deployment")," page of the Parachain Devops guide.")),(0,r.yg)("p",null,"Next, submit the extrinsic ",(0,r.yg)("inlineCode",{parentName:"p"},"session.setKeys")," with the collator account to the Acurast Canary or Acurast Mainnet chain. The first parameter of the extrinsic call is the ",(0,r.yg)("inlineCode",{parentName:"p"},"result")," hex string in the output of the previous RPC call."),(0,r.yg)("p",null,"Any tool can be used to submit the extrinsic call, the important thing is that it is submitted by the collator account."),(0,r.yg)("p",null,"One option is to use the polkadotjs UI web app:"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("a",{parentName:"li",href:"https://dotapps-io.ipns.dweb.link/?rpc=wss%3A%2F%2Fpublic-rpc.canary.acurast.com#/extrinsics"},"Acurast Canary")),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("a",{parentName:"li",href:"https://dotapps-io.ipns.dweb.link/?rpc=wss%3A%2F%2Fpublic-rpc.mainnet.acurast.com#/extrinsics"},"Acurast Mainnet"))),(0,r.yg)(o.A,{width:"1000px",sources:{light:(0,i.A)("/img/set-session-keys.png"),dark:(0,i.A)("/img/set-session-keys.png")},mdxType:"ThemedImage"}),(0,r.yg)("p",null,"The screenshot above show how to call the ",(0,r.yg)("inlineCode",{parentName:"p"},"session.setKeys")," extrinsic, where the first drop down menu selects the account submitting the extrinsic (in this example, the account comes from the PolkadotJS Chrome extension)."),(0,r.yg)("p",null,"Then the ",(0,r.yg)("inlineCode",{parentName:"p"},"submit the following extrinsic")," box, the ",(0,r.yg)("inlineCode",{parentName:"p"},"session")," pallet and the ",(0,r.yg)("inlineCode",{parentName:"p"},"setKeys")," extrinsic are selected. Finally, provide the arguments: first the key, which corresponds to the result of the previous RPC call, and a ",(0,r.yg)("inlineCode",{parentName:"p"},"0x00")," for the proof argument."),(0,r.yg)("h3",{id:"register-as-candidate"},"Register as candidate"),(0,r.yg)("p",null,"Once the session key is registered, the collator can be registered as a candidate, this is done through the extrinsic ",(0,r.yg)("inlineCode",{parentName:"p"},"collatorSelection.registerAsCandidate"),", as before, the important thing is that the extrinsic is submitted by the collator account:"),(0,r.yg)(o.A,{width:"1000px",sources:{light:(0,i.A)("/img/register-as-candidate.png"),dark:(0,i.A)("/img/register-as-candidate.png")},mdxType:"ThemedImage"}),(0,r.yg)("p",null,"If the extrinsic is submitted successfully, the collator node is now fully onboarded and should start authoring blocks within 6-12 hours."))}g.isMDXComponent=!0}}]);